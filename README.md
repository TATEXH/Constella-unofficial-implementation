# Constella

AI支援によるクリエイティブライティングシステム

## 概要

Constellaは、AI（Ollama）を活用してストーリーテリングを支援するWebアプリケーションです。キャラクター作成、ジャーナル生成、コメント機能を通じて、創作活動を効率化し、新しいアイデアの発見を促進します。

## 主な機能

### 🎭 キャラクター管理
- **キャラクター作成・編集・削除**
- **画像アップロード**（プロフィール画像の設定）
- **属性管理**（詳細な設定項目）
- **関係性管理**（キャラクター同士のつながり）
- **インポート/エクスポート**（JSON形式でのバックアップ・共有）

### 🤖 AI生成機能
- **Friends Discovery**: 既存キャラクターから新しい関連キャラクターを3体自動生成
- **ジャーナル生成**: キャラクターの視点から日記形式のエントリーを生成
- **コメント生成**: ジャーナルに対する他キャラクターからのコメントを生成
- **スレッド機能**: コメントの返信・階層表示

### 💬 インタラクション機能
- **コメントスレッド**: 返信機能付きの階層コメント表示
- **履歴管理**: キャラクター別のジャーナル・コメント履歴
- **リアルタイム更新**: 生成処理中のローディング表示

## キャラクター属性の詳細

キャラクター作成時に設定できる属性の種類と記入例：

### 📝 description（説明・外見）
キャラクターの基本的な紹介や外見的特徴

**例:**
```
元気いっぱいの17歳の高校生。黒髪のショートカットで、いつも明るい笑顔を浮かべている。
```

**詳細な例:**
```
25歳の図書館司書。肩まで伸びた栗色の髪を後ろで束ね、丸縁の眼鏡をかけている。
穏やかな表情だが、好きな本の話になると目が輝く。身長は160cm程度で、
落ち着いた色合いのカーディガンを好んで着用している。
```

### 💭 personality（性格・内面）
キャラクターの性格、思考パターン、価値観

**例:**
```
好奇心旺盛で行動力がある。時々おっちょこちょいだが、困っている人を見ると放っておけない性格。
```

**詳細な例:**
```
内向的で慎重な性格。新しい環境に馴染むのに時間がかかるが、一度打ち解けると
深い信頼関係を築く。完璧主義的な一面があり、責任感が強い。
読書と静かな音楽を愛し、人混みよりも少数の親しい友人との時間を大切にする。
```

### 🌟 currentStatus（現在の状況・状態）
現時点でのキャラクターの置かれた状況や抱えている問題

**例:**
```
大学受験を控えており、将来の進路について悩んでいる。部活動と勉強の両立に苦労中。
```

**詳細な例:**
```
転職活動中で新しい職場を探している。前職での人間関係のストレスから
一時的に実家に戻って心を休めている状態。新しいスタートを切りたい気持ちと
不安な気持ちが入り混じっている。週末は地域のボランティア活動に参加して
社会とのつながりを保っている。
```

### 📚 backstory（背景・過去）
キャラクターの生い立ちや重要な過去の出来事

**例:**
```
幼少期に両親を亡くし、祖母に育てられた。祖母の影響で料理が得意になり、人を喜ばせることに生きがいを感じる。
```

**詳細な例:**
```
東京で生まれ育ったが、10歳の時に父親の仕事の都合で地方の小さな町に引っ越した。
最初は都会との違いに戸惑ったが、地域の図書館で出会った年配の司書に影響を受け、
本の世界に深く魅力を感じるようになった。高校卒業後は都市部の大学で文学を学び、
卒業後は故郷の町に戻って図書館司書として働いている。
```

## 関係性の設定

キャラクター同士の関係性を設定することで、より豊かなストーリー展開が可能になります。

### Friends Discovery機能
既存のキャラクターに「関係性のフレーズ」を入力することで、AI が関連する新しいキャラクターを3体生成します。

**関係性フレーズの例:**
- `最大の敵`
- `幼馴染`
- `憧れの先輩`
- `ライバル関係`
- `師弟関係`
- `兄弟のような存在`
- `秘密を共有する仲間`

## 技術スタック

### フロントエンド
- **React.js** - UI構築
- **Bootstrap** - スタイリング
- **Axios** - API通信

### バックエンド
- **FastAPI** - Webフレームワーク
- **Python 3.11** - プログラミング言語
- **MongoDB** - データベース
- **Motor** - 非同期MongoDBドライバー
- **Pydantic** - データ検証

### AI・その他
- **Ollama** - AI モデル実行環境
- **Docker** - コンテナ化
- **uvicorn** - ASGI サーバー

## セットアップ

### 必要な環境
- Docker & Docker Compose
- Ollama（gpt-oss:20B モデル）

### 起動手順

1. **リポジトリのクローン**
```bash
git clone https://github.com/TATEXH/Constella-unofficial-implementation.git
cd Constella
```

2. **環境変数の設定**
```bash
# .envファイルを作成
cp .env.example .env

# 必要に応じて設定を編集
```

3. **Docker環境の起動**
```bash
docker-compose up -d
```

4. **アクセス**
- **フロントエンド**: http://localhost:3000
- **バックエンド API**: http://localhost:8000
- **MongoDB管理**: http://localhost:8081

### 環境変数

```env
MONGODB_URL=mongodb://admin:constella_password_2024@localhost:27017/constella?authSource=admin
OLLAMA_API_URL=http://192.168.1.7:11434
OLLAMA_MODEL=gpt-oss:20B
UPLOAD_DIR=/app/uploads
API_PORT=8000
```

## API エンドポイント

### キャラクター関連
- `GET /api/characters/` - キャラクター一覧取得
- `POST /api/characters/` - キャラクター作成
- `PUT /api/characters/{id}` - キャラクター更新
- `DELETE /api/characters/{id}` - キャラクター削除
- `POST /api/characters/{id}/image` - 画像アップロード
- `GET /api/characters/export/all` - 全キャラクターエクスポート
- `POST /api/characters/import` - キャラクターインポート

### ジャーナル関連
- `GET /api/journals/` - ジャーナル一覧取得
- `POST /api/journals/generate` - ジャーナル生成
- `PUT /api/journals/{id}` - ジャーナル編集
- `DELETE /api/journals/{id}` - ジャーナル削除

### コメント関連
- `GET /api/comments/journal/{journal_id}` - ジャーナルのコメント取得
- `POST /api/comments/generate` - コメント生成
- `DELETE /api/comments/{id}` - コメント削除

### AI生成関連
- `POST /api/discovery/friends` - Friends Discovery実行

## 開発情報

### テスト実行
```bash
# フロントエンドテスト
cd frontend && npm test

# バックエンドテスト
cd backend && pytest

# リント実行
cd backend && ruff check .

# 型チェック
cd backend && mypy .
```

### コーディング規約
- **日本語**: コメント・ドキュメントは日本語
- **命名規則**:
  - 変数・関数: camelCase
  - コンポーネント: PascalCase
  - ファイル: kebab-case

### コミットメッセージ
```
[機能名] 変更内容

例: [キャラクター管理] 属性編集機能を追加
```

## ライセンス

MIT License

## 貢献

プルリクエストやイシューの報告を歓迎します。

---

**Constella** - AI と共に創る、新しいストーリーテリング体験